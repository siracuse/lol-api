<?php
function getChampionById($id){
    switch($id){
        case 266: return "Aatrox"; break;
        case 412: return "Thresh"; break;
        case 23: return "Tryndamere"; break;
        case 79: return "Gragas"; break;
        case 69: return "Cassiopeia"; break;
        case 136: return "Aurelion Sol"; break;
        case 13: return "Ryze"; break;
        case 78: return "Poppy"; break;
        case 14: return "Sion"; break;
        case 1: return "Annie"; break;
        case 202: return "Jhin"; break;
        case 43: return "Karma"; break;
        case 111: return "Nautilus"; break;
        case 240: return "Kled"; break;
        case 99: return "Lux"; break;
        case 103: return "Ahri"; break;
        case 2: return "Olaf"; break;
        case 112: return "Viktor"; break;
        case 34: return "Anivia"; break;
        case 27: return "Singed"; break;
        case 86: return "Garen"; break;
        case 127: return "Lissandra"; break;
        case 57: return "Maokai"; break;
        case 25: return "Morgana"; break;
        case 28: return "Evelynn"; break;
        case 105: return "Fizz"; break;
        case 74: return "Heimerdinger"; break;
        case 238: return "Zed"; break;
        case 68: return "Rumble"; break;
        case 82: return "Mordekaiser"; break;
        case 37: return "Sona"; break;
        case 96: return "Kog'Maw"; break;
        case 55: return "Katarina"; break;
        case 117: return "Lulu"; break;
        case 22: return "Ashe"; break;
        case 30: return "Karthus"; break;
        case 12: return "Alistar"; break;
        case 122: return "Darius"; break;
        case 67: return "Vayne"; break;
        case 110: return "Varus"; break;
        case 77: return "Udyr"; break;
        case 89: return "Leona"; break;
        case 126: return "Jayce"; break;
        case 134: return "Syndra"; break;
        case 80: return "Pantheon"; break;
        case 92: return "Riven"; break;
        case 121: return "Kha'Zix"; break;
        case 42: return "Corki"; break;
        case 268: return "Azir"; break;
        case 51: return "Caitlyn"; break;
        case 76: return "Nidalee"; break;
        case 85: return "Kennen"; break;
        case 3: return "Galio"; break;
        case 45: return "Veigar"; break;
        case 432: return "Bard"; break;
        case 150: return "Gnar"; break;
        case 90: return "Malzahar"; break;
        case 104: return "Graves"; break;
        case 254: return "Vi"; break;
        case 10: return "Kayle"; break;
        case 39: return "Irelia"; break;
        case 64: return "Lee Sin"; break;
        case 420: return "Illaoi"; break;
        case 60: return "Elise"; break;
        case 106: return "Volibear"; break;
        case 20: return "Nunu"; break;
        case 4: return "Twisted Fate"; break;
        case 24: return "Jax"; break;
        case 102: return "Shyvana"; break;
        case 429: return "Kalista"; break;
        case 36: return "Dr. Mundo"; break;
        case 427: return "Ivern"; break;
        case 131: return "Diana"; break;
        case 223: return "Tahm Kench"; break;
        case 63: return "Brand"; break;
        case 113: return "Sejuani"; break;
        case 8: return "Vladimir"; break;
        case 154: return "Zac"; break;
        case 421: return "Rek'Sai"; break;
        case 133: return "Quinn"; break;
        case 84: return "Akali"; break;
        case 163: return "Taliyah"; break;
        case 18: return "Tristana"; break;
        case 120: return "Hecarim"; break;
        case 15: return "Sivir"; break;
        case 236: return "Lucian"; break;
        case 107: return "Rengar"; break;
        case 19: return "Warwick"; break;
        case 72: return "Skarner"; break;
        case 54: return "Malphite"; break;
        case 157: return "Yasuo"; break;
        case 101: return "Xerath"; break;
        case 17: return "Teemo"; break;
        case 75: return "Nasus"; break;
        case 58: return "Renekton"; break;
        case 119: return "Draven"; break;
        case 35: return "Shaco"; break;
        case 50: return "Swain"; break;
        case 91: return "Talon"; break;
        case 40: return "Janna"; break;
        case 115: return "Ziggs"; break;
        case 245: return "Ekko"; break;
        case 61: return "Orianna"; break;
        case 114: return "Fiora"; break;
        case 9: return "Fiddlesticks"; break;
        case 31: return "Cho'Gath"; break;
        case 33: return "Rammus"; break;
        case 7: return "LeBlanc"; break;
        case 16: return "Soraka"; break;
        case 26: return "Zilean"; break;
        case 56: return "Nocturne"; break;
        case 222: return "Jinx"; break;
        case 83: return "Yorick"; break;
        case 6: return "Urgot"; break;
        case 203: return "Kindred"; break;
        case 21: return "Miss Fortune"; break;
        case 62: return "Wukong"; break;
        case 53: return "Blitzcrank"; break;
        case 98: return "Shen"; break;
        case 201: return "Braum"; break;
        case 5: return "Xin Zhao"; break;
        case 29: return "Twitch"; break;
        case 11: return "Master Yi"; break;
        case 44: return "Taric"; break;
        case 32: return "Amumu"; break;
        case 41: return "Gangplank"; break;
        case 48: return "Trundle"; break;
        case 38: return "Kassadin"; break;
        case 161: return "Vel'Koz"; break;
        case 143: return "Zyra"; break;
        case 267: return "Nami"; break;
        case 59: return "Jarvan IV"; break;
        case 81: return "Ezreal"; break;
        case 164: return "Camille"; break;
        case 517: return "Sylas"; break;
        case 555: return "Pyke"; break;
        case 145: return "Kai'Sa"; break;
        case 497: return "Rakan"; break;
        case 518: return "Neeko"; break;
        case 141: return "Kayn"; break;
        case 142: return "Zoé"; break;
    }
}

function secondesConvertMinutes ($time) {
    return date('i:s', $time);
}

function getTypeMatch($id) {
    switch($id){
        case 0: return "Aléatoire"; break;
        case 400: return "5v5 Mode Draft"; break;
        case 420: return "5v5 Mode Classé<br>SOLO/DUO"; break;
        case 430: return "5v5 Mode Aveugle"; break;
        case 440: return "5v5 Mode Classé<br>FLEX"; break;
        case 450: return "5v5 Mode ARAM"; break;
        case 460: return "3v3 Mode Aveugle"; break;
        case 470: return "3v3 Mode Classé<br>FLEX"; break;
        default: return "Autre";
    }
}

function getSpellName($id) {
    switch($id){
        case 1: return "Purge"; break;
        case 3: return "Fatigue"; break;
        case 4: return "Flash"; break;
        case 6: return "Fantôme"; break;
        case 7: return "Soins"; break;
        case 11: return "Smite"; break;
        case 12: return "Téléportation"; break;
        case 13: return "Clarté"; break;
        case 14: return "Embrasement"; break;
        case 21: return "Barrière"; break;
        case 32: return "Boule de neige"; break;
        default: return "Autre";
    }
}

function getSummonerIdByName($name) {
    $myName = str_replace(' ', '%20', $name);
    $summoner = json_decode(file_get_contents('https://euw1.api.riotgames.com/lol/summoner/v4/summoners/by-name/'.$myName.'?api_key=RGAPI-0e42ad56-15b8-41e5-ba9b-be0d56cc05bd'));
    return $summoner->accountId;
}

function getEncryptedSummonerIdByName($name) {
    $myName = str_replace(' ', '%20', $name);
    $summoner = json_decode(file_get_contents('https://euw1.api.riotgames.com/lol/summoner/v4/summoners/by-name/'.$myName.'?api_key=RGAPI-0e42ad56-15b8-41e5-ba9b-be0d56cc05bd'));
    return $summoner->id;
}

function getWinAndPos($id, $matcheDetails) {
    $winAndPos = [];
    for ($k = 0; $k <= 9; $k++) {
        if ($matcheDetails->participantIdentities[$k]->player->accountId === $id) {
            if ($matcheDetails->participants[$k]->stats->win === true) {
                $winAndPos[0] = 1;
            }else {
                $winAndPos[0] = 0;
            }
            $winAndPos[1] = $k;
        }
    }
    return $winAndPos;
}

function getHistoryById($id, $encryptedId, $name) {

    $html = '';

    $rank = json_decode(file_get_contents('https://euw1.api.riotgames.com/lol/league/v4/entries/by-summoner/'.$encryptedId.'?api_key=RGAPI-0e42ad56-15b8-41e5-ba9b-be0d56cc05bd'));
//        https://euw1.api.riotgames.com/lol/champion-mastery/v4/champion-masteries/by-summoner/nBwdXd8wion0kNMzREp0toL0gnIHa-UsxGI_k704XROYdU4?api_key=RGAPI-9304d754-4084-40d9-a4e4-9b873b7a81ad
    $html .= "<div class='col-xs-12 col-sm-6 col-sm-offset-6 col-md-4 col-md-offset-8 mg-bt-20'>
               <form method='post' class='histo-form'>
                <div class='form-group histo-form-input'>
                    <input name= 'summoner' type='text' class='form-control' placeholder='Nom ...' list='pseudo' required>
                    <datalist id='pseudo'>
                        <option value='FFB Katamooundi'>
                        <option value='FFB Cédric ß'>
                        <option value='FFB Harichandra'>
                        <option value='igouf974'>
                        <option value='LordFoulPixel'>
                    </datalist>
                </div>
                <button type='submit' class='btn btn-default' name='envoyer'>Valider</button>
            </form>
            </div>";
    $html .= "<div class='col-md-12 mg-bt-20 histo-intro'>";

        $html .= "<div class='col-xs-12 col-sm-6 col-md-6 histo-rank-block'>";


        if (!empty($rank)) {
            if (!empty($rank[1])) {
                $html .= "<img class='histo-rank' src='img/rank/" . $rank[1]->tier . ".png' >";
            } else  {
                $html .= "<img class='histo-rank' src='img/rank/" . $rank[0]->tier . ".png' >";
            }
        }
        $html .= "<h1 class='text-center mg-bt-40 histo-pseudo'>".$name."</h1></div>";

        $mastery = json_decode(file_get_contents('https://euw1.api.riotgames.com/lol/champion-mastery/v4/champion-masteries/by-summoner/'.$encryptedId.'?api_key=RGAPI-0e42ad56-15b8-41e5-ba9b-be0d56cc05bd'));
        $html .= "<div class='col-xs-12 col-sm-6 col-md-6 histo-mastery-content mg-tp-40'><div class='histo-mastery-bandeau' style='margin-top:50px;'>";
            $html .= "<img src='img/champ/".$mastery[1]->championId.".png' class='histo-mastery'> ";
            $html .= "<img src='img/mastery/".$mastery[1]->championLevel.".png' class='histo-mastery-img'> ";
        $html .= "</div>";
        $html .= "<div class='histo-mastery-bandeau' style='margin-top:-50px;'>";
            $html .= "<img src='img/champ/".$mastery[0]->championId.".png' class='histo-mastery'> ";
            $html .= "<img src='img/mastery/".$mastery[0]->championLevel.".png' class='histo-mastery-img'> ";
        $html .= "</div>";
        $html .= "<div class='histo-mastery-bandeau' style='margin-top:50px;'>";
            $html .= "<img src='img/champ/".$mastery[2]->championId.".png' class='histo-mastery'> ";
            $html .= "<img src='img/mastery/".$mastery[2]->championLevel.".png' class='histo-mastery-img'> ";
        $html .= "</div></div>";
    $html .= "</div>";
//        var_dump($mastery);
//        die();







    //Historique en fonction du summoners
    $matches = json_decode(file_get_contents('https://euw1.api.riotgames.com/lol/match/v4/matchlists/by-account/'.$id.'?api_key=RGAPI-0e42ad56-15b8-41e5-ba9b-be0d56cc05bd'));



    for ($i = 0; $i <= 9; $i++) {
//        $html .= "<p>";
//    echo"Champion ID : ".($matches->matches[$i]->champion)." / ";
//    echo (getChampionById($matches->matches[$i]->champion))." / ";
//    echo "Lane : ". ($matches->matches[$i]->lane)." / ";
//        $html .= "Matche ID : ". ($matches->matches[$i]->gameId)." / ";
//        $html .= "Date : ". gmdate('m/d/Y', $matches->matches[$i]->timestamp) ." / ";
        //details d'un match en fonction du match ID
        $matcheDetails = json_decode(file_get_contents('https://euw1.api.riotgames.com/lol/match/v4/matches/'. $matches->matches[$i]->gameId.'?api_key=RGAPI-0e42ad56-15b8-41e5-ba9b-be0d56cc05bd'));
//    var_dump($matcheDetails->participants[0]->stats->totalMinionsKilled + $matcheDetails->participants[0]->stats->neutralMinionsKilled);
//    die();


        $k = getWinAndPos($id, $matcheDetails);

        if ($i === 9) {
            $html .= " <a type='button' data-toggle='collapse' data-target='#histoDetails". $i . "'> <div class='col-md-12 mg-bt-40 histo-bandeau-".$k[0]."'>";
        } else {
            $html .= " <a type='button' data-toggle='collapse' data-target='#histoDetails". $i . "'> <div class='col-md-12 mg-bt-20 histo-bandeau-".$k[0]."'>";
        }



            $html .= "<div class='col-md-12 histo-bandeau-solo'>";
                $html .= "<div class='col-xs-6 col-md-2 histo-bandeau-solo-1'>";
                    $html .= "<p>".getTypeMatch($matcheDetails->queueId)." </p> ";
                    $html .= "<p>".secondesConvertMinutes($matcheDetails->gameDuration)."</p>";
                $html .= "</div>";
                $html .= "<div class='col-xs-6 col-md-3'>";
                    $html .= "<img src='img/champ/".$matcheDetails->participants[$k[1]]->championId.".png' class='histo-bandeau-champ'> ";
                    $html .= "<img class='histo-bandeau-spell' src='img/spell/".$matcheDetails->participants[$k[1]]->spell1Id.".png'> <img class='histo-bandeau-spell' src='img/spell/".$matcheDetails->participants[$k[1]]->spell2Id.".png' > ";
                $html .= " </div> ";
//                $html .= "<div class='col-md-1'>".$matcheDetails->participants[$k[1]]->stats->champLevel ."</div>";
                $html .= "<div class='col-xs-4 col-md-2'>".$matcheDetails->participants[$k[1]]->stats->kills." / ".$matcheDetails->participants[$k[1]]->stats->deaths." / ".$matcheDetails->participants[$k[1]]->stats->assists." <img src='img/sword.png' style='width:15px;margin-left:10px;margin-top:-2px;'></div>";
                $html .= "<div class='col-xs-3 col-md-2'>". ($matcheDetails->participants[$k[1]]->stats->totalMinionsKilled + $matcheDetails->participants[$k[1]]->stats->neutralMinionsKilled) ." <img src='img/cs.png' style='margin-top:-2px;'> </div>";
                $html .= "<div class='col-xs-3 col-md-2'>".round(number_format($matcheDetails->participants[$k[1]]->stats->goldEarned, 0, '', '.'), 1)."k <img src='img/gold.png' style='margin-top:-2px;'>  </div>";
                $html .= "<div class='col-xs-2  col-md-1'>";
                    $html .= " <img src='img/arrow-down.png' class='img-responsive histo-bandeau-solo-6'>";
                $html .= "</div>";
            $html .= "</div></a>";


            $html .= "<div id='histoDetails".$i. "' class='collapse col-md-12 mg-bt-20'>" ;
                $html .= "<br><div class='col-md-6 pd-0'> <p class='histo-team'>";
                    if($matcheDetails->teams[0]->win === 'Win'){$html .=  'VICTOIRE';}else{$html .= 'DÉFAITE';}
                $html .= "</p>";
                $html .= "<div class='col-xs-12 col-md-12'>
                            <div class='col-xs-2 col-xs-offset-6 col-md-2 col-md-offset-6 text-center'><img src='img/sword.png' style='width:15px;'></div>
                            <div class='col-xs-2 col-md-2 text-center'><img src='img/cs.png' style='margin-left:10px;'></div>
                            <div class='col-xs-2 col-md-2 text-center'><img src='img/gold.png' style='margin-left:10px;'></div>
                          </div>";
                    for ($j = 0; $j <= 4; $j++) {
                    $kda = $matcheDetails->participants[$j]->stats;
        //            $html .= "Spell : ". getSpellName($matcheDetails->participants[$j]->spell1Id)." / ". getSpellName($matcheDetails->participants[$j]->spell2Id) ." --> ";
                    $html .= "<div class='col-md-12 histo-bandeau-details-1 pd-0'> <div class='col-md-2 pd-0 histo-bandeau-details-1-1'>";
                        $html .= "<img src='img/champ/".$matcheDetails->participants[$j]->championId.".png' class='histo-bandeau-champ' >";
                        $html .= "<div class='histo-bandeau-details-1-1-1'><img src='img/spell/".$matcheDetails->participants[$j]->spell1Id.".png' class='histo-bandeau-spell'> <img src='img/spell/".$matcheDetails->participants[$j]->spell2Id.".png' class='histo-bandeau-spell'></div> ";
                    $html .= "</div>";
//                    $html .= "Lvl : ". ($matcheDetails->participants[$j]->stats->champLevel) ." ";
        //            $html .=(getChampionById($matcheDetails->participants[$j]->championId)). " --> ";

                    $html .= "<div class='col-md-4  pd-0'>".($matcheDetails->participantIdentities[$j]->player->summonerName)." </div> ";
        //        echo($matcheDetails->participants[$j]->participantId)." --> ";
                    $html .= "<div class='col-md-2  pd-0 text-center'> ".$kda->kills."/".$kda->deaths."/".$kda->assists."</div>";
                    $html .= "<div class='col-md-2  pd-0 text-center'> ". ($matcheDetails->participants[$j]->stats->totalMinionsKilled + $matcheDetails->participants[$j]->stats->neutralMinionsKilled) ." </div>";
                    $html .= "<div class='col-md-2 pd-0 text-center'> ". round(number_format($matcheDetails->participants[$j]->stats->goldEarned, 0, '', '.'), 1) ."k  </div></div> ";
                }
                $html .= "</div><div class='col-md-6 pd-0'> <p class='histo-team'>";
                    if($matcheDetails->teams[1]->win === 'Win'){$html .=  'VICTOIRE';}else{$html .= 'DÉFAITE';}
                $html .= "</p>";
                $html .= "<div class='col-xs-12 col-md-12'>
                            <div class='col-xs-2 col-xs-offset-6 col-md-2 col-md-offset-6 text-center'><img src='img/sword.png' style='width:15px;'></div>
                            <div class='col-xs-2 col-md-2 text-center'><img src='img/cs.png' style='margin-left:10px;'></div>
                            <div class='col-xs-2 col-md-2 text-center'><img src='img/gold.png' style='margin-left:10px;'></div>
                          </div>";
                for ($k = 5; $k <= 9; $k++) {
                    $kda = $matcheDetails->participants[$k]->stats;
        //            $html .= "Spell : ". getSpellName($matcheDetails->participants[$k]->spell1Id)." / ". getSpellName($matcheDetails->participants[$k]->spell2Id) ." -->";
                    $html .= "<div class='col-md-12 histo-bandeau-details-1 pd-0'> <div class='col-md-2 pd-0 histo-bandeau-details-1-1'>";
                        $html .= "<img src='img/champ/".$matcheDetails->participants[$k]->championId.".png' class='histo-bandeau-champ' >";
                        $html .= "<div class='histo-bandeau-details-1-1-1'><img src='img/spell/".$matcheDetails->participants[$k]->spell1Id.".png' class='histo-bandeau-spell'> <img src='img/spell/".$matcheDetails->participants[$k]->spell2Id.".png' class='histo-bandeau-spell'></div> ";
                    $html .= "</div>";
        //            $html .=(getChampionById($matcheDetails->participants[$k]->championId)). " --> ";
                    $html .= "<div class='col-md-4  pd-0'>".($matcheDetails->participantIdentities[$k]->player->summonerName)." </div> ";
                    //        echo($matcheDetails->participants[$j]->participantId)." --> ";
                    $html .= "<div class='col-md-2  pd-0 text-center'> ".$kda->kills."/".$kda->deaths."/".$kda->assists."</div>";
                    $html .= "<div class='col-md-2  pd-0 text-center'> ". ($matcheDetails->participants[$k]->stats->totalMinionsKilled + $matcheDetails->participants[$k]->stats->neutralMinionsKilled) ." </div>";
                    $html .= "<div class='col-md-2 pd-0 text-center'> ". round(number_format($matcheDetails->participants[$k]->stats->goldEarned, 0, '', '.'), 1) ."k  </div></div> ";
                }
            $html .= "</div></div>" ;
        $html .= "</div>";
    }
    return $html;
}